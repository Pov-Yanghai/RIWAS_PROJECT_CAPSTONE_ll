<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>PDF Viewer</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    #pdf-container { border: 1px solid #ccc; width: 100%; height: 600px; overflow: auto; }
    canvas { display: block; margin: 10px auto; border: 1px solid #999; }
  </style>
</head>
<body>

<h2>PDF Viewer with Token</h2>
<button id="loadPdf">Load PDF</button>
<div id="pdf-container"></div>

<script src="pdfjs-5.4.530-dist/build/pdf.mjs.map"></script>
<script>
  // Set path for worker
 pdfjsLib.GlobalWorkerOptions.workerSrc = './libs/pdfjs/pdf.worker.js';

      async function fetchPDFWithToken(url, token) {
    const response = await fetch(url, {
      headers: { 'Authorization': `Bearer ${token}` }
    });
    if (!response.ok) throw new Error(`Failed to fetch PDF: ${response.status}`);
    const blob = await response.blob();
    return blob;
  }

  async function renderPDF(blob) {
    const arrayBuffer = await blob.arrayBuffer();
    const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;

    const container = document.getElementById('pdf-container');
    container.innerHTML = ''; // clear old pages

    for (let pageNum = 1; pageNum <= pdf.numPages; pageNum++) {
      const page = await pdf.getPage(pageNum);
      const viewport = page.getViewport({ scale: 1.5 });
      const canvas = document.createElement('canvas');
      const context = canvas.getContext('2d');
      canvas.width = viewport.width;
      canvas.height = viewport.height;
      await page.render({ canvasContext: context, viewport }).promise;
      container.appendChild(canvas);
    }
  }

  document.getElementById('loadPdf').addEventListener('click', async () => {
    try {
      const token = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjY5NDhhZjg3LWMxYjktNGU1Mi1iYTkxLTUxY2I0ODc5MTczMCIsInJvbGUiOiJjYW5kaWRhdGUiLCJpYXQiOjE3NjkzMzg4MDMsImV4cCI6MTc2OTk0MzYwM30.UbmN1EMaJqFfoYYyzPJN6oW895BEh9aTdZjNfIwYEIg'; // replace with actual token
      const url = 'http://localhost:5000/api/jobapplications/b108e05b-f1b1-49e8-9e48-7419cc14151b/resume';
      const pdfBlob = await fetchPDFWithToken(url, token);
      await renderPDF(pdfBlob);
    } catch (err) {
      alert(err.message);
      console.error(err);
    }
  });
</script>

</body>
</html>
